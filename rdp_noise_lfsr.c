/**
 * This is free and unencumbered software released into the public domain.
 *
 * Anyone is free to copy, modify, publish, use, compile, sell, or
 * distribute this software, either in source code form or as a compiled
 * binary, for any purpose, commercial or non-commercial, and by any
 * means.
 *
 * In jurisdictions that recognize copyright laws, the author or authors
 * of this software dedicate any and all copyright interest in the
 * software to the public domain. We make this dedication for the benefit
 * of the public at large and to the detriment of our heirs and
 * successors. We intend this dedication to be an overt act of
 * relinquishment in perpetuity of all present and future rights to this
 * software under copyright law.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR
 * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * For more information, please refer to <http://unlicense.org>
 */
#include <assert.h>
#include <stdbool.h>
#include <stdio.h>

typedef signed char byte;
typedef unsigned char ubyte;
typedef unsigned int uint;

#define ARRLEN(a) (sizeof(a) / sizeof(*(a)))

// This data was dumped from console by rendering a 1016x1 rectangle in 1-cycle mode.

// The random numbers have the bitwise structure abc100000 prior to Color Combiner clamping,
// where we assume that a,b,c are all sourced from independent but potentially different LFSRs,
// however we can only measure the output after the clamp operation.
// CC clamping works by examining the two most significant bits (a and b here) and performing:
//  - If a=0,         result=bc100000
//  - If a=1 and b=0, result=11111111
//  - If a=1 and b=1, result=00000000
// Given these observables and the assumption on the structure of the input, a and b can always
// be uniquely determined. However, it is not possible to determine c whenever a=1. See fb2data.py
// For a and b, the Berlekamp-Massey algorithm can be straightforwardly applied to the data sets
// to determine the minimal LFSR. For c, we employ a brute force search over all primitive polynomials
// in GF(2^m) for m <= 32, looking for LFSRs that match the bits that were recoverable in the dataset.

static const ubyte A_dataset[] = {
    0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0,
    1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,
    1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1,
    1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 0,
    1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1,
    0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1,
    1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1,
    0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1,
    0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0,
    1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1,
    0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1,
    1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0,
    0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0,
    1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0,
    1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0,
    1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1,
    0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1,
    0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1,
    0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0,
    1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1,
    1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0,
    0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1,
    0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0,
    0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0,
    0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0,
    1, 0,
};

static const ubyte B_dataset[] = {
    0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0,
    0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0,
    1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1,
    1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0,
    0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0,
    1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0,
    0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1,
    1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1,
    0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1,
    1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1,
    0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1,
    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0,
    1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0,
    1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0,
    1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1,
    1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0,
    0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1,
    1, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0,
    0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1,
    1, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1,
    0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0,
    1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1,
    0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0,
    0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0,
    1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1,
    1, 1, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1,
    0, 0,
};

// Note that bits that could not be uniquely recovered are represented by -1.
#define DATA_SIZE 1016
static const byte C_datasets[][DATA_SIZE] = {
    {
        1,  0,  -1, 0,  0,  -1, -1, 0,  1,  -1, 0,  -1, 0,  1,  -1, 0,  1,  1,
        1,  1,  1,  0,  1,  -1, -1, 0,  -1, -1, -1, -1, -1, 1,  -1, 1,  1,  -1,
        1,  -1, -1, -1, 0,  -1, 0,  0,  1,  0,  0,  1,  1,  0,  1,  1,  -1, -1,
        -1, 1,  1,  -1, -1, 1,  -1, -1, -1, -1, 0,  -1, -1, 1,  1,  0,  -1, 0,
        -1, 1,  -1, 1,  -1, 1,  -1, 0,  -1, -1, 1,  0,  1,  0,  -1, -1, -1, 0,
        0,  -1, -1, -1, 1,  0,  1,  0,  1,  -1, 0,  1,  0,  -1, 0,  1,  0,  -1,
        1,  0,  -1, 1,  -1, 1,  -1, -1, 0,  0,  1,  1,  -1, -1, 0,  -1, 0,  -1,
        0,  -1, -1, -1, -1, -1, 0,  -1, 0,  -1, -1, -1, -1, 1,  -1, -1, -1, 0,
        1,  1,  0,  0,  1,  -1, -1, -1, 1,  -1, -1, -1, 0,  0,  -1, -1, 1,  -1,
        -1, -1, 1,  1,  -1, -1, -1, 1,  0,  -1, 0,  -1, 0,  -1, 1,  -1, -1, 0,
        0,  0,  -1, -1, 1,  -1, 0,  1,  -1, 1,  1,  -1, -1, -1, -1, 0,  1,  -1,
        1,  -1, -1, -1, 1,  -1, -1, -1, 1,  0,  1,  1,  1,  -1, -1, -1, 1,  -1,
        0,  0,  1,  0,  -1, -1, 1,  1,  1,  0,  -1, 0,  0,  -1, -1, -1, 0,  1,
        -1, 1,  -1, 1,  -1, 0,  0,  -1, -1, -1, 1,  -1, 1,  -1, 0,  1,  -1, 1,
        -1, 1,  -1, -1, -1, -1, 0,  1,  -1, 1,  -1, -1, -1, 0,  -1, -1, -1, -1,
        0,  0,  -1, 0,  0,  0,  -1, 0,  -1, -1, -1, 0,  -1, -1, 1,  0,  -1, 1,
        -1, -1, -1, 0,  1,  -1, 0,  0,  -1, -1, 1,  -1, 0,  1,  0,  1,  0,  -1,
        0,  0,  -1, -1, -1, 1,  0,  0,  0,  -1, 0,  1,  -1, -1, -1, -1, 0,  -1,
        1,  0,  -1, 0,  0,  1,  0,  1,  0,  1,  -1, 0,  -1, -1, 1,  0,  1,  1,
        0,  0,  -1, 1,  -1, -1, 0,  1,  -1, 1,  0,  1,  0,  -1, 0,  -1, 0,  -1,
        1,  -1, 0,  1,  0,  -1, -1, -1, -1, -1, -1, -1, -1, 0,  -1, -1, 0,  -1,
        1,  1,  0,  1,  1,  1,  -1, 0,  0,  0,  -1, 1,  0,  1,  0,  1,  -1, -1,
        0,  0,  -1, -1, 1,  0,  0,  -1, -1, -1, 0,  -1, 1,  -1, 0,  -1, 1,  0,
        0,  0,  1,  -1, 0,  -1, 1,  -1, 0,  0,  -1, 0,  -1, -1, 1,  -1, 1,  -1,
        -1, 1,  0,  1,  -1, 1,  1,  1,  -1, 1,  -1, 0,  -1, 1,  0,  1,  -1, 0,
        0,  0,  1,  -1, 0,  0,  -1, 1,  0,  0,  -1, -1, -1, -1, -1, 0,  -1, 1,
        -1, -1, -1, 0,  -1, -1, -1, -1, -1, 1,  -1, 1,  -1, 0,  0,  1,  1,  -1,
        0,  -1, 1,  1,  -1, -1, 1,  1,  0,  -1, 0,  0,  -1, -1, -1, 0,  1,  -1,
        -1, 1,  -1, -1, -1, 0,  -1, 1,  -1, 1,  0,  1,  -1, 0,  -1, -1, 1,  -1,
        1,  -1, -1, -1, -1, 1,  1,  -1, 0,  -1, -1, 0,  -1, -1, 1,  0,  0,  -1,
        1,  0,  0,  1,  1,  -1, 1,  1,  -1, 1,  0,  0,  -1, -1, 0,  0,  1,  0,
        -1, 0,  0,  -1, 0,  1,  -1, 0,  -1, 0,  0,  1,  0,  1,  0,  0,  -1, 0,
        -1, -1, -1, -1, -1, 1,  1,  1,  1,  0,  0,  -1, 0,  -1, -1, -1, -1, 1,
        -1, -1, -1, -1, -1, -1, -1, -1, -1, 1,  -1, -1, 1,  1,  -1, -1, -1, -1,
        -1, -1, -1, -1, 1,  -1, -1, 1,  1,  -1, 1,  1,  -1, -1, 1,  0,  -1, -1,
        1,  1,  1,  -1, -1, -1, -1, 1,  1,  -1, -1, 1,  0,  -1, -1, -1, 0,  1,
        0,  0,  -1, 0,  -1, -1, 1,  -1, 0,  1,  -1, 0,  -1, 0,  0,  -1, -1, 1,
        -1, 0,  1,  -1, 0,  -1, -1, 1,  1,  0,  1,  0,  0,  -1, 0,  1,  -1, 0,
        1,  0,  0,  -1, 0,  1,  0,  1,  -1, -1, -1, 0,  -1, 1,  0,  0,  -1, -1,
        -1, -1, -1, -1, -1, -1, 1,  -1, 0,  0,  1,  0,  0,  0,  -1, 0,  -1, 0,
        -1, -1, 0,  1,  0,  -1, 1,  -1, 0,  0,  -1, -1, 0,  1,  -1, -1, 0,  -1,
        -1, -1, -1, -1, -1, -1, -1, 1,  -1, -1, -1, 1,  1,  1,  1,  1,  -1, 0,
        1,  0,  1,  -1, -1, -1, -1, 0,  1,  1,  -1, -1, 1,  1,  -1, -1, 1,  0,
        0,  -1, -1, 0,  -1, 0,  -1, 0,  -1, -1, -1, -1, -1, -1, 1,  1,  -1, -1,
        -1, -1, -1, 1,  0,  0,  1,  -1, -1, -1, -1, -1, 0,  0,  0,  -1, 1,  0,
        1,  -1, -1, 0,  0,  -1, -1, -1, -1, 0,  0,  -1, -1, 0,  -1, 0,  -1, 1,
        0,  -1, -1, 1,  1,  0,  1,  1,  -1, 0,  -1, 1,  0,  -1, 0,  -1, -1, 0,
        0,  -1, 1,  -1, -1, 0,  -1, -1, -1, 1,  -1, 0,  1,  -1, 1,  -1, 0,  -1,
        1,  0,  0,  -1, 0,  -1, -1, -1, 1,  1,  1,  0,  -1, 1,  1,  -1, 0,  0,
        -1, -1, -1, 1,  -1, 0,  0,  0,  -1, 0,  1,  1,  0,  0,  -1, 1,  1,  -1,
        -1, -1, -1, -1, -1, 0,  -1, 0,  0,  0,  0,  -1, -1, 1,  -1, -1, -1, -1,
        -1, 1,  -1, 1,  -1, 0,  -1, -1, -1, -1, 1,  0,  -1, -1, 1,  1,  0,  -1,
        1,  -1, 0,  -1, -1, 0,  -1, -1, 0,  0,  -1, -1, -1, 0,  -1, -1, -1, 1,
        0,  -1, -1, -1, -1, 0,  0,  1,  0,  0,  -1, 0,  0,  0,  -1, -1, -1, 0,
        1,  0,  1,  -1, -1, 1,  -1, -1, 0,  1,  1,  0,  -1, -1, 1,  1,  1,  1,
        1,  1,  1,  -1, 1,  -1, 0,  1,  -1, -1, -1, -1, -1, -1, 0,  1,  0,  -1,
        -1, -1, -1, -1, -1, 0,  0,  0,
    },
    {
        -1, 0,  1,  -1, 1,  -1, -1, -1, 1,  -1, 0,  1,  0,  1,  -1, -1, -1, -1, -1,
        1,  1,  1,  -1, -1, 1,  -1, 0,  -1, 0,  0,  1,  0,  -1, 1,  1,  -1, -1, -1,
        1,  -1, 0,  -1, 0,  0,  -1, -1, 1,  0,  0,  1,  1,  -1, -1, -1, 1,  -1, -1,
        -1, -1, -1, -1, 1,  -1, 1,  1,  -1, -1, -1, 0,  -1, -1, -1, -1, 0,  1,  1,
        1,  0,  1,  1,  -1, -1, 0,  -1, -1, 0,  0,  -1, -1, 0,  -1, -1, -1, -1, 1,
        0,  -1, 1,  0,  -1, -1, 0,  -1, 0,  -1, 0,  -1, 0,  -1, -1, 0,  -1, -1, 0,
        -1, 0,  1,  -1, 0,  1,  -1, -1, 0,  -1, 1,  1,  1,  1,  -1, -1, -1, 1,  -1,
        -1, -1, 0,  -1, -1, 0,  -1, -1, 0,  -1, -1, -1, -1, 0,  -1, 1,  1,  -1, 0,
        1,  1,  0,  0,  0,  -1, -1, 0,  -1, -1, 0,  0,  0,  -1, -1, -1, 0,  1,  0,
        -1, -1, 0,  1,  0,  -1, 0,  -1, -1, -1, -1, -1, -1, -1, -1, 0,  1,  1,  -1,
        -1, -1, -1, -1, 1,  0,  -1, 1,  -1, 0,  0,  -1, 0,  -1, 1,  0,  0,  -1, -1,
        1,  1,  -1, -1, 0,  1,  1,  0,  0,  -1, -1, 0,  1,  -1, 0,  -1, -1, -1, 0,
        -1, 0,  1,  1,  -1, 1,  -1, 1,  1,  -1, 1,  -1, -1, 0,  -1, 0,  -1, 1,  -1,
        -1, 1,  -1, 1,  1,  1,  -1, -1, 1,  -1, -1, -1, -1, -1, 0,  -1, -1, -1, -1,
        1,  -1, -1, 1,  -1, -1, -1, 0,  -1, -1, 0,  -1, -1, -1, -1, -1, 1,  0,  1,
        -1, -1, 1,  1,  -1, 0,  1,  -1, -1, 1,  -1, -1, 1,  -1, -1, 1,  1,  0,  -1,
        -1, -1, 1,  1,  -1, -1, 1,  -1, 0,  -1, -1, 1,  -1, 0,  0,  0,  1,  -1, -1,
        -1, 1,  1,  1,  -1, -1, -1, -1, -1, 0,  0,  -1, 0,  -1, -1, 0,  -1, -1, -1,
        0,  0,  1,  -1, 0,  -1, 0,  -1, -1, 1,  1,  1,  1,  1,  -1, -1, 0,  0,  -1,
        1,  -1, -1, -1, 1,  1,  0,  -1, -1, 1,  -1, 0,  -1, -1, -1, 1,  -1, -1, 0,
        -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  0,  1,  -1, -1, 0,  -1, 1,  -1, -1, 1,
        -1, -1, -1, 0,  0,  -1, 0,  1,  -1, 0,  1,  0,  -1, 0,  1,  -1, 0,  0,  1,
        0,  1,  -1, -1, -1, 0,  -1, -1, 0,  -1, -1, 1,  1,  1,  1,  -1, 0,  -1, -1,
        -1, -1, -1, 1,  -1, 1,  0,  1,  0,  1,  1,  0,  -1, -1, 0,  -1, -1, 0,  -1,
        -1, 1,  -1, 1,  -1, 0,  1,  1,  -1, -1, 1,  1,  -1, 0,  0,  0,  1,  0,  0,
        0,  1,  1,  -1, -1, -1, 0,  1,  1,  -1, -1, -1, 0,  -1, -1, -1, -1, -1, 1,
        0,  0,  0,  -1, 0,  -1, 0,  -1, 1,  -1, 0,  -1, 0,  0,  -1, -1, -1, -1, -1,
        0,  1,  -1, 0,  1,  -1, -1, 0,  0,  1,  0,  0,  0,  -1, 1,  1,  1,  -1, 1,
        0,  0,  -1, 1,  -1, -1, 1,  1,  -1, -1, -1, -1, 0,  -1, 0,  0,  -1, 0,  -1,
        0,  -1, 1,  -1, -1, -1, -1, -1, 1,  -1, 0,  -1, -1, -1, 1,  0,  1,  1,  -1,
        -1, 1,  1,  1,  -1, 1,  -1, -1, -1, 1,  -1, -1, -1, 1,  0,  -1, -1, 1,  -1,
        -1, -1, 0,  0,  -1, 1,  -1, 0,  -1, -1, 1,  -1, 1,  -1, -1, -1, 1,  0,  -1,
        0,  0,  -1, -1, -1, -1, 1,  0,  1,  -1, -1, 1,  -1, 0,  1,  1,  -1, 0,  0,
        -1, 0,  0,  0,  -1, -1, 1,  -1, 0,  0,  0,  1,  -1, -1, 1,  0,  1,  0,  0,
        -1, -1, -1, 0,  -1, 0,  -1, -1, -1, -1, 1,  -1, 0,  -1, -1, 0,  -1, -1, -1,
        -1, -1, -1, 1,  1,  0,  1,  1,  1,  0,  -1, -1, 1,  -1, -1, -1, 1,  1,  -1,
        -1, -1, 0,  -1, -1, 0,  -1, -1, 0,  0,  -1, -1, 0,  -1, 0,  -1, 0,  -1, 0,
        -1, -1, 1,  -1, -1, 0,  0,  0,  0,  -1, -1, 1,  -1, -1, 1,  -1, -1, 1,  -1,
        1,  0,  -1, 0,  1,  0,  -1, 0,  1,  1,  -1, -1, -1, 0,  0,  1,  1,  1,  0,
        -1, -1, -1, 1,  1,  1,  -1, -1, -1, 0,  -1, 1,  1,  0,  0,  0,  -1, 0,  -1,
        1,  1,  -1, -1, -1, -1, -1, -1, -1, -1, 1,  0,  -1, 1,  -1, 1,  1,  -1, -1,
        -1, 0,  -1, 1,  -1, 0,  -1, -1, -1, 1,  -1, 0,  0,  -1, -1, 1,  1,  -1, -1,
        0,  -1, 0,  1,  0,  -1, 1,  -1, -1, 1,  0,  1,  -1, 1,  1,  1,  -1, -1, 0,
        -1, -1, -1, -1, 0,  0,  0,  0,  -1, -1, -1, 0,  -1, 1,  -1, -1, -1, 1,  0,
        1,  0,  0,  -1, 1,  -1, 0,  0,  -1, 0,  0,  -1, -1, 0,  -1, 1,  -1, 1,  1,
        -1, -1, -1, 0,  -1, -1, 1,  1,  1,  0,  0,  1,  1,  -1, 0,  1,  0,  0,  -1,
        0,  -1, -1, 1,  -1, -1, -1, 0,  -1, 0,  1,  -1, -1, -1, 1,  0,  0,  1,  0,
        1,  0,  0,  1,  -1, 0,  -1, 1,  -1, -1, -1, 0,  0,  1,  -1, -1, 1,  -1, -1,
        -1, -1, 1,  1,  -1, 0,  -1, 0,  -1, 1,  -1, 1,  -1, 1,  1,  1,  -1, 1,  0,
        -1, -1, -1, -1, -1, 0,  0,  1,  -1, -1, 0,  1,  0,  0,  -1, 1,  0,  0,  -1,
        0,  0,  1,  -1, 0,  -1, 0,  0,  0,  1,  -1, -1, 0,  1,  -1, 1,  -1, 0,  0,
        -1, 0,  -1, 1,  -1, -1, -1, -1, -1, 1,  -1, 0,  -1, -1, -1, 1,  -1, 1,  -1,
        0,  0,  -1, 0,  -1, -1, -1, 0,  -1, 1,  1,  0,  -1, 1,  1,  -1, -1, 0,  1,
        0,  -1, 1,  1,  -1, -1, -1, 0,  -1,
    },
    {
        1,  0,  -1, -1, -1, -1, -1, -1, 0,  1,  0,  0,  1,  1,  1,  1,  -1, -1, 0,
        -1, -1, 1,  0,  -1, 0,  1,  -1, 1,  0,  0,  0,  -1, -1, 1,  0,  -1, -1, -1,
        -1, -1, -1, -1, -1, -1, -1, 1,  1,  1,  -1, -1, -1, -1, 0,  -1, 1,  1,  1,
        0,  0,  1,  -1, -1, -1, -1, 1,  0,  -1, -1, 0,  1,  -1, -1, 0,  0,  0,  0,
        0,  -1, -1, 1,  0,  0,  -1, 1,  -1, 1,  -1, 0,  -1, -1, 0,  0,  -1, 0,  -1,
        -1, 1,  -1, 0,  0,  -1, 1,  -1, 0,  -1, 0,  0,  -1, 1,  -1, 0,  0,  0,  -1,
        1,  0,  0,  -1, -1, -1, -1, 1,  -1, -1, 1,  -1, -1, -1, -1, 1,  -1, -1, -1,
        0,  -1, 0,  1,  1,  -1, 1,  -1, 1,  0,  1,  0,  0,  -1, -1, 1,  1,  1,  -1,
        -1, -1, 1,  1,  -1, -1, -1, 1,  1,  -1, 1,  0,  1,  0,  1,  -1, 0,  1,  0,
        0,  0,  1,  0,  -1, -1, -1, -1, -1, 0,  0,  -1, 0,  -1, -1, 0,  1,  0,  0,
        -1, 0,  -1, 1,  -1, 1,  1,  0,  0,  1,  1,  1,  0,  0,  -1, -1, 0,  0,  -1,
        0,  -1, -1, -1, 1,  1,  0,  1,  1,  1,  -1, 1,  0,  1,  -1, 1,  -1, 1,  -1,
        1,  -1, 0,  -1, 0,  1,  -1, 0,  -1, -1, -1, 0,  0,  -1, 1,  -1, 1,  -1, 1,
        -1, -1, -1, -1, -1, 1,  -1, -1, -1, 1,  -1, -1, -1, 0,  -1, 0,  0,  1,  -1,
        -1, 1,  -1, 1,  0,  1,  -1, 1,  1,  0,  -1, -1, 0,  1,  -1, 1,  1,  -1, -1,
        -1, 0,  1,  -1, 0,  0,  1,  0,  0,  -1, -1, -1, 1,  -1, 1,  -1, -1, -1, -1,
        -1, 0,  1,  1,  1,  -1, 0,  -1, -1, 0,  0,  0,  0,  -1, 0,  -1, 1,  -1, 0,
        1,  -1, -1, -1, 0,  -1, -1, 1,  0,  -1, -1, -1, -1, -1, -1, 1,  -1, -1, 1,
        -1, 0,  -1, 0,  0,  1,  -1, 1,  0,  0,  0,  -1, -1, 1,  -1, -1, 0,  -1, 1,
        1,  -1, -1, 0,  1,  -1, 0,  1,  -1, 1,  1,  0,  -1, 0,  -1, 1,  0,  1,  1,
        1,  0,  -1, -1, -1, 0,  0,  1,  -1, 0,  -1, -1, 0,  -1, 0,  1,  0,  0,  -1,
        1,  -1, 0,  0,  0,  -1, 1,  -1, 1,  -1, 0,  -1, -1, 0,  1,  0,  0,  1,  -1,
        1,  0,  -1, 0,  1,  0,  1,  1,  1,  -1, 1,  0,  0,  0,  1,  -1, 1,  0,  1,
        -1, 1,  0,  -1, 1,  -1, 0,  -1, 1,  0,  1,  1,  -1, 1,  -1, 0,  -1, 0,  -1,
        -1, -1, -1, -1, -1, -1, 0,  -1, 0,  -1, -1, -1, -1, 0,  -1, -1, -1, 1,  -1,
        1,  -1, 1,  0,  1,  -1, 1,  0,  1,  -1, -1, 1,  0,  -1, -1, 0,  -1, -1, -1,
        1,  1,  -1, -1, -1, 1,  0,  -1, 0,  0,  0,  -1, 1,  -1, 0,  0,  1,  1,  1,
        -1, -1, -1, -1, 0,  0,  0,  -1, -1, 0,  -1, 0,  1,  -1, -1, -1, -1, 0,  -1,
        0,  -1, -1, -1, 1,  -1, 1,  -1, 1,  -1, -1, 0,  1,  -1, 1,  -1, 0,  0,  -1,
        0,  1,  1,  1,  -1, -1, 1,  0,  0,  -1, 1,  0,  -1, -1, -1, 1,  -1, -1, -1,
        0,  1,  0,  0,  -1, 0,  1,  0,  1,  -1, 0,  -1, 1,  -1, -1, 0,  -1, 1,  -1,
        -1, -1, -1, 0,  1,  -1, 1,  0,  -1, -1, -1, -1, -1, -1, 1,  -1, 0,  -1, 1,
        0,  0,  -1, 0,  0,  -1, 0,  0,  0,  -1, -1, 1,  1,  0,  0,  -1, 1,  -1, -1,
        1,  1,  -1, -1, 1,  -1, -1, -1, 1,  -1, 1,  -1, -1, -1, -1, 0,  -1, 1,  -1,
        -1, 0,  -1, 0,  -1, 0,  1,  1,  -1, -1, -1, -1, 1,  0,  1,  -1, -1, 0,  -1,
        -1, -1, 0,  1,  -1, -1, -1, 1,  -1, -1, 1,  -1, -1, -1, 0,  -1, 1,  -1, -1,
        1,  0,  -1, 1,  -1, 0,  1,  -1, 0,  0,  -1, -1, -1, -1, 0,  1,  -1, 0,  0,
        -1, 0,  1,  -1, -1, -1, 1,  -1, -1, 0,  -1, 0,  0,  0,  -1, 0,  -1, -1, -1,
        -1, 0,  1,  -1, -1, -1, -1, 1,  -1, 0,  1,  1,  0,  -1, -1, 1,  -1, -1, 1,
        -1, -1, -1, -1, -1, 1,  -1, -1, 0,  0,  -1, 0,  -1, -1, 0,  0,  -1, 1,  0,
        0,  0,  1,  1,  -1, -1, -1, 1,  0,  0,  -1, -1, 1,  0,  -1, 1,  0,  -1, 0,
        -1, -1, -1, 0,  0,  0,  1,  -1, 0,  -1, 0,  -1, 1,  -1, -1, 1,  1,  1,  1,
        1,  -1, -1, -1, -1, 1,  -1, 0,  0,  0,  -1, -1, 1,  -1, 1,  -1, 1,  1,  1,
        -1, 0,  0,  0,  -1, -1, -1, -1, -1, -1, -1, 0,  1,  -1, -1, -1, 0,  -1, 1,
        -1, -1, 1,  -1, -1, -1, 1,  -1, 0,  -1, -1, -1, -1, -1, 0,  1,  -1, -1, 0,
        0,  -1, 1,  -1, -1, 1,  0,  1,  -1, 1,  1,  -1, 0,  0,  -1, -1, -1, 0,  -1,
        -1, 1,  0,  -1, -1, -1, -1, 1,  0,  1,  1,  -1, 1,  1,  -1, 0,  -1, 0,  0,
        0,  0,  -1, 0,  -1, -1, 0,  1,  1,  -1, -1, -1, -1, 1,  1,  -1, -1, -1, -1,
        -1, -1, 0,  -1, 1,  1,  1,  -1, 0,  -1, 0,  -1, -1, -1, 0,  1,  0,  0,  0,
        -1, -1, 0,  1,  0,  1,  -1, -1, 1,  1,  -1, -1, -1, 1,  -1, 1,  -1, -1, -1,
        1,  -1, -1, 1,  1,  1,  0,  1,  1,  1,  -1, -1, -1, -1, -1, -1, 0,  0,  1,
        0,  -1, -1, 0,  -1, -1, -1, 1,  1,  -1, 0,  0,  -1, 0,  -1, 1,  -1, 0,  -1,
        0,  1,  -1, -1, 0,  0,  -1, 1,  -1, 0,  -1, -1, 0,  -1, -1, 0,  1,  1,  0,
        -1, 0,  -1, -1, -1, 0,  -1, -1, -1,
    },
    {
        -1, 1,  1,  -1, 0,  -1, -1, 0,  -1, 0,  -1, -1, -1, -1, 0,  -1, 0,  0,  -1,
        -1, 0,  0,  -1, -1, 1,  0,  -1, -1, 1,  0,  0,  0,  -1, 1,  1,  -1, 0,  0,
        0,  -1, -1, 0,  0,  0,  -1, 1,  -1, -1, 1,  -1, 1,  0,  -1, 1,  -1, -1, 1,
        -1, 0,  -1, 0,  0,  1,  1,  -1, 1,  -1, 1,  1,  -1, 0,  -1, 1,  1,  1,  -1,
        -1, -1, 0,  -1, 1,  1,  1,  -1, -1, -1, 1,  -1, -1, -1, -1, -1, -1, 1,  -1,
        -1, -1, -1, 1,  -1, -1, -1, -1, -1, 1,  0,  -1, 1,  0,  1,  0,  0,  -1, -1,
        1,  -1, -1, 0,  1,  -1, -1, 0,  -1, -1, 1,  0,  -1, 1,  1,  -1, -1, 0,  1,
        0,  1,  -1, 1,  -1, 0,  -1, 0,  0,  -1, 0,  0,  -1, 0,  -1, -1, 0,  -1, -1,
        0,  -1, 1,  0,  1,  1,  -1, -1, -1, -1, -1, -1, 1,  -1, -1, -1, 1,  -1, 1,
        0,  0,  1,  -1, 1,  1,  -1, 1,  1,  -1, 0,  1,  1,  0,  0,  1,  -1, -1, 1,
        0,  -1, -1, -1, 0,  0,  -1, 0,  0,  0,  1,  0,  0,  -1, 1,  -1, -1, -1, -1,
        1,  -1, 1,  -1, 0,  -1, 1,  1,  -1, 0,  -1, -1, 1,  1,  1,  0,  -1, 0,  -1,
        0,  -1, 1,  -1, -1, -1, 1,  0,  -1, -1, -1, 1,  -1, -1, -1, 1,  -1, 1,  1,
        1,  -1, -1, -1, -1, -1, -1, 1,  -1, -1, -1, 0,  -1, -1, 0,  1,  0,  1,  -1,
        -1, 0,  -1, -1, 1,  1,  1,  -1, 1,  -1, 1,  1,  -1, -1, 1,  0,  -1, 0,  0,
        -1, -1, -1, 1,  0,  0,  0,  0,  1,  -1, -1, -1, 1,  0,  1,  0,  1,  -1, 0,
        0,  1,  1,  -1, -1, -1, -1, 0,  -1, 0,  1,  -1, -1, -1, -1, -1, -1, -1, -1,
        1,  0,  -1, 0,  -1, 1,  -1, 1,  1,  0,  1,  0,  0,  -1, -1, 0,  1,  1,  -1,
        0,  -1, -1, 0,  0,  -1, -1, 1,  0,  -1, 0,  -1, -1, -1, 1,  -1, -1, -1, -1,
        -1, -1, -1, -1, 0,  0,  1,  1,  0,  -1, 0,  0,  -1, 0,  -1, -1, 1,  -1, 1,
        0,  1,  -1, -1, 0,  -1, -1, 0,  0,  -1, -1, 1,  0,  -1, 0,  -1, 0,  -1, 1,
        1,  0,  1,  -1, 0,  1,  -1, 0,  0,  1,  1,  0,  -1, -1, -1, 1,  1,  1,  1,
        -1, -1, -1, -1, 0,  -1, -1, -1, 1,  -1, 0,  -1, 0,  0,  0,  0,  -1, 1,  -1,
        1,  -1, 1,  0,  -1, -1, -1, -1, -1, -1, 0,  0,  -1, -1, -1, 0,  0,  -1, 1,
        0,  1,  -1, 0,  -1, 0,  -1, -1, -1, 1,  -1, -1, -1, -1, 1,  1,  -1, -1, 1,
        0,  1,  0,  -1, -1, 1,  -1, 1,  0,  1,  1,  1,  -1, 0,  0,  0,  -1, -1, 0,
        -1, -1, 0,  0,  -1, 1,  -1, -1, 0,  -1, 1,  -1, 1,  1,  -1, 0,  0,  0,  0,
        0,  1,  1,  -1, 1,  -1, 1,  0,  -1, 0,  1,  -1, 0,  -1, -1, -1, 1,  0,  0,
        -1, 1,  0,  0,  0,  -1, 0,  -1, 1,  -1, 0,  -1, 1,  1,  0,  -1, 1,  -1, -1,
        -1, -1, 0,  -1, -1, 1,  1,  0,  1,  0,  -1, 1,  -1, 0,  -1, -1, -1, 1,  -1,
        -1, -1, 1,  -1, 0,  -1, -1, -1, 0,  0,  -1, -1, -1, 1,  0,  1,  0,  1,  0,
        0,  -1, 0,  0,  0,  -1, -1, 1,  -1, -1, 1,  0,  0,  -1, 0,  1,  -1, -1, -1,
        -1, 1,  0,  -1, 1,  -1, 0,  -1, 0,  -1, 1,  1,  1,  1,  0,  -1, -1, -1, 1,
        0,  0,  0,  1,  -1, 1,  -1, -1, 0,  0,  -1, 0,  -1, -1, -1, 0,  -1, -1, -1,
        1,  -1, 1,  -1, 0,  -1, -1, 1,  1,  0,  0,  1,  1,  0,  -1, 1,  1,  -1, 1,
        -1, -1, -1, 1,  0,  -1, 1,  0,  -1, -1, -1, 0,  -1, -1, -1, 0,  0,  0,  0,
        0,  1,  1,  1,  1,  -1, 0,  -1, -1, -1, 0,  1,  -1, 1,  -1, -1, -1, -1, 1,
        0,  -1, 1,  1,  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1,  -1, -1, 1,
        1,  1,  0,  -1, 0,  0,  -1, -1, 1,  -1, 0,  1,  1,  1,  -1, -1, 0,  1,  -1,
        -1, 0,  1,  -1, -1, 0,  -1, -1, 1,  -1, 0,  -1, 1,  1,  1,  1,  -1, -1, -1,
        1,  -1, 0,  -1, 0,  0,  -1, 0,  -1, -1, 1,  -1, 0,  0,  -1, 1,  0,  -1, 0,
        1,  1,  -1, 1,  -1, 1,  -1, -1, 1,  0,  0,  -1, 0,  1,  0,  1,  -1, 0,  1,
        -1, 1,  1,  0,  1,  -1, 0,  -1, -1, -1, -1, -1, 0,  -1, -1, -1, 0,  0,  1,
        0,  1,  -1, 1,  -1, 1,  -1, -1, -1, -1, 1,  -1, 0,  -1, 0,  1,  0,  -1, -1,
        1,  1,  -1, 1,  1,  -1, -1, -1, -1, -1, -1, -1, 1,  -1, -1, -1, 0,  0,  -1,
        -1, -1, 1,  -1, -1, -1, -1, -1, 0,  1,  0,  1,  -1, 1,  -1, -1, 0,  0,  -1,
        -1, 1,  1,  1,  -1, -1, 1,  -1, 0,  0,  -1, -1, -1, 0,  0,  -1, -1, 1,  -1,
        0,  -1, 1,  1,  1,  -1, -1, -1, -1, 0,  0,  1,  0,  0,  -1, -1, -1, 0,  -1,
        0,  0,  -1, -1, -1, -1, 1,  0,  0,  -1, 0,  1,  0,  1,  0,  -1, -1, 0,  1,
        0,  1,  1,  1,  0,  -1, -1, 0,  -1, -1, -1, -1, 0,  1,  -1, -1, -1, -1, -1,
        1,  -1, 0,  -1, 1,  -1, -1, 1,  -1, 0,  -1, 1,  -1, 1,  -1, -1, 1,  -1, -1,
        1,  0,  -1, 0,  -1, -1, 0,  0,  -1, -1, -1, 1,  -1, -1, -1, 1,  0,  0,  -1,
        1,  0,  0,  -1, 1,  0,  -1, 0,  0,  -1, 0,  -1, -1, -1, 1,  1,  0,  0,  -1,
        -1, 0,  -1, -1, 1,  0,  1,  1,  1,
    },
};

// Generated from https://www.partow.net/programming/polynomials/index.html with a script.
// Note that an LFSR need not be a primitive polynomial, but these have the nicest properties
// such as a maximal period of 2^degree - 1
static const struct lfsr_poly {
    uint degree; // Degree of the primitive polynomial, up to 32
    uint mask;   // Coefficients of the primitive polynomial
} lfsrs[] = {
    { 2, 0b11 },
    { 3, 0b101 },
    { 4, 0b1001 },
    { 5, 0b10010 },
    { 5, 0b11011 },
    { 5, 0b11110 },
    { 6, 0b100001 },
    { 6, 0b110011 },
    { 6, 0b110110 },
    { 7, 0b1000001 },
    { 7, 0b1000100 },
    { 7, 0b1000111 },
    { 7, 0b1001110 },
    { 7, 0b1011111 },
    { 7, 0b1100101 },
    { 7, 0b1101010 },
    { 7, 0b1110010 },
    { 7, 0b1111011 },
    { 8, 0b10001110 },
    { 8, 0b10010101 },
    { 8, 0b10101111 },
    { 8, 0b10110001 },
    { 8, 0b10110010 },
    { 8, 0b10110100 },
    { 8, 0b11100001 },
    { 8, 0b11110011 },
    { 9, 0b100001000 },
    { 9, 0b100010110 },
    { 9, 0b100101100 },
    { 9, 0b100110111 },
    { 9, 0b100111011 },
    { 9, 0b101101101 },
    { 9, 0b110001001 },
    { 9, 0b110011000 },
    { 9, 0b110110000 },
    { 9, 0b110110101 },
    { 9, 0b111000010 },
    { 9, 0b111000111 },
    { 9, 0b111110001 },
    { 9, 0b111110100 },
    { 10, 0b1000000100 },
    { 10, 0b1000001101 },
    { 10, 0b1000110111 },
    { 10, 0b1010000110 },
    { 10, 0b1010001100 },
    { 10, 0b1010010001 },
    { 10, 0b1010011000 },
    { 10, 0b1011110010 },
    { 10, 0b1011111101 },
    { 10, 0b1100001001 },
    { 10, 0b1100111111 },
    { 10, 0b1110100110 },
    { 10, 0b1110110001 },
    { 10, 0b1111111100 },
    { 11, 0b10000000010 },
    { 11, 0b10000010101 },
    { 11, 0b10000010110 },
    { 11, 0b10000110001 },
    { 11, 0b10001000110 },
    { 11, 0b10010010010 },
    { 11, 0b10010111001 },
    { 11, 0b10010111111 },
    { 11, 0b10100001001 },
    { 11, 0b10111001001 },
    { 11, 0b11000000110 },
    { 11, 0b11001001101 },
    { 11, 0b11011011101 },
    { 11, 0b11110000101 },
    { 12, 0b100000101001 },
    { 12, 0b100100000110 },
    { 12, 0b100110000111 },
    { 12, 0b101110100010 },
    { 12, 0b101110111010 },
    { 12, 0b110000101011 },
    { 12, 0b110100010101 },
    { 12, 0b110101101000 },
    { 12, 0b110101110000 },
    { 12, 0b110111001000 },
    { 12, 0b110111010011 },
    { 12, 0b111000010011 },
    { 12, 0b111010101101 },
    { 12, 0b111111011101 },
    { 13, 0b1000000001101 },
    { 13, 0b1000101011111 },
    { 13, 0b1000111010001 },
    { 13, 0b1001101011000 },
    { 13, 0b1001110100111 },
    { 13, 0b1010011001001 },
    { 13, 0b1011111111111 },
    { 13, 0b1100000111100 },
    { 13, 0b1100011110000 },
    { 13, 0b1100110001010 },
    { 13, 0b1101010101110 },
    { 13, 0b1110000010011 },
    { 13, 0b1110011101001 },
    { 13, 0b1110100010100 },
    { 14, 0b10000010100001 },
    { 14, 0b10001000100001 },
    { 14, 0b10001101101101 },
    { 14, 0b10010000100001 },
    { 14, 0b10010100110010 },
    { 14, 0b10100111111000 },
    { 14, 0b10110111110101 },
    { 14, 0b10111101001100 },
    { 14, 0b11000000110101 },
    { 14, 0b11001011011111 },
    { 14, 0b11010000111011 },
    { 14, 0b11010010010111 },
    { 14, 0b11111001100001 },
    { 14, 0b11111100110000 },
    { 15, 0b100000000000001 },
    { 15, 0b100000000001000 },
    { 15, 0b100000001000000 },
    { 15, 0b100000001100111 },
    { 15, 0b100001000010001 },
    { 15, 0b100001000011000 },
    { 15, 0b100001000011011 },
    { 15, 0b100001101010100 },
    { 15, 0b100001110010100 },
    { 15, 0b100010001100011 },
    { 15, 0b100100000000101 },
    { 15, 0b100100000011110 },
    { 15, 0b100110011101010 },
    { 15, 0b111111111111110 },
    { 16, 0b1000000111101110 },
    { 16, 0b1000100000000101 },
    { 16, 0b1000100001000010 },
    { 16, 0b1001101101100001 },
    { 16, 0b1001110001100101 },
    { 16, 0b1001111000100011 },
    { 16, 0b1010001010000101 },
    { 16, 0b1011100000110110 },
    { 16, 0b1011101001000000 },
    { 16, 0b1100001000110111 },
    { 16, 0b1100010111011011 },
    { 16, 0b1100011001110111 },
    { 16, 0b1100011100100011 },
    { 16, 0b1100011110101011 },
    { 17, 0b10000000000000100 },
    { 17, 0b10000000000000111 },
    { 17, 0b10000000000010000 },
    { 17, 0b10000000000100000 },
    { 17, 0b10000000010001100 },
    { 17, 0b10000000011101100 },
    { 17, 0b10000001110110110 },
    { 17, 0b10000100000100111 },
    { 17, 0b10000100100011111 },
    { 17, 0b10000100101101110 },
    { 17, 0b10010010001010111 },
    { 17, 0b10101010101010100 },
    { 17, 0b10101010101101011 },
    { 17, 0b11000000000000101 },
    { 18, 0b100000000000011111 },
    { 18, 0b100000000001000000 },
    { 18, 0b100000000001010011 },
    { 18, 0b100000000010000011 },
    { 18, 0b100000000101111000 },
    { 18, 0b100000000110111011 },
    { 18, 0b100000000111101011 },
    { 18, 0b100000001001010000 },
    { 18, 0b100000001010010000 },
    { 18, 0b100000001011111111 },
    { 18, 0b100000001100000100 },
    { 18, 0b100001000000101000 },
    { 18, 0b100100000000010010 },
    { 18, 0b100100000100000010 },
    { 19, 0b1000000000000010011 },
    { 19, 0b1000000000000011111 },
    { 19, 0b1000000000000100011 },
    { 19, 0b1000000000000110111 },
    { 19, 0b1000000000000111110 },
    { 19, 0b1000000000001010111 },
    { 19, 0b1000000000011010000 },
    { 19, 0b1000000000011011111 },
    { 19, 0b1000000000011101111 },
    { 19, 0b1000000000110010000 },
    { 19, 0b1000000000110110111 },
    { 19, 0b1000000000111001111 },
    { 19, 0b1000000010111111110 },
    { 19, 0b1000000011011011111 },
    { 19, 0b1001001001001001001 },
    { 20, 0b10000000000000000100 },
    { 20, 0b10000000000100010100 },
    { 20, 0b10000000010010100110 },
    { 20, 0b10000010001110111000 },
    { 20, 0b10010010001001001110 },
    { 20, 0b11000000000000001100 },
    { 21, 0b100000000000000000010 },
    { 21, 0b100000000000011001110 },
    { 21, 0b100000000001000101110 },
    { 21, 0b100000001000000010010 },
    { 21, 0b100000010000001000010 },
    { 21, 0b100000010000001100110 },
    { 21, 0b100000010100001101110 },
    { 21, 0b100000100001100011110 },
    { 21, 0b111100000000000011110 },
    { 22, 0b1000000000000000000001 },
    { 22, 0b1000000000000100010001 },
    { 22, 0b1000000011100001000111 },
    { 22, 0b1000010000000101000011 },
    { 22, 0b1000010001100011000011 },
    { 22, 0b1010101000000000101011 },
    { 23, 0b10000000000000000010000 },
    { 23, 0b10000000000000000011001 },
    { 23, 0b10000000000011001110000 },
    { 23, 0b10000000000100000011000 },
    { 23, 0b10000000100001101011100 },
    { 23, 0b10000001001000000110100 },
    { 23, 0b10000010000010000010000 },
    { 23, 0b10000010000010110011001 },
    { 23, 0b10000101001010010010010 },
    { 23, 0b10100000000000001010000 },
    { 24, 0b100000000000000001000011 },
    { 24, 0b100101111111001100011001 },
    { 24, 0b101010101010010111011000 },
    { 25, 0b1000000000000000000000100 },
    { 25, 0b1000000000000000000000111 },
    { 25, 0b1000000000000010110101110 },
    { 25, 0b1000000000000100000001100 },
    { 25, 0b1000000000000110011101100 },
    { 25, 0b1000000010000001000000111 },
    { 25, 0b1000000100000110000111100 },
    { 25, 0b1000010000000000000010100 },
    { 25, 0b1000010001000010000010111 },
    { 25, 0b1010101000000000101010100 },
    { 26, 0b10000000000000000000100011 },
    { 26, 0b10000001001111010111110110 },
    { 26, 0b10000100101101110110111100 },
    { 26, 0b10001011001001010111011011 },
    { 26, 0b10001100001000111010011101 },
    { 26, 0b10011101100111011110110010 },
    { 26, 0b10100100011011010001101001 },
    { 27, 0b100000000000000000000010011 },
    { 27, 0b100000000100000011100011100 },
    { 27, 0b100001000000001010000111100 },
    { 27, 0b100001000010111000000100001 },
    { 27, 0b100001110110101100001010000 },
    { 27, 0b100100001001000100011000111 },
    { 27, 0b100100101001001010100111100 },
    { 27, 0b101010100000001010111110111 },
    { 27, 0b101010111101010001011001100 },
    { 28, 0b1000000000000000000000000100 },
    { 28, 0b1000000000000001010100010100 },
    { 28, 0b1000000000111000000100011100 },
    { 28, 0b1000000001010100001000100110 },
    { 28, 0b1000001000000000011000001100 },
    { 28, 0b1000100010001000100010001100 },
    { 29, 0b10000000000000000000000000010 },
    { 29, 0b10000000000000000100001000010 },
    { 29, 0b10000000000100010000000100110 },
    { 29, 0b10000000001001000000000100110 },
    { 29, 0b10000000010000000010000000010 },
    { 29, 0b10000000010001000010010001110 },
    { 29, 0b10000000100000000000000010010 },
    { 29, 0b10000010000000000001100011110 },
    { 29, 0b10000100000000011000010001110 },
    { 29, 0b10010000000000000000000010010 },
    { 30, 0b100000010000000000000000000011 },
    { 30, 0b100000100010001011010001000011 },
    { 30, 0b100000100110100101100101101101 },
    { 30, 0b100001110001101010010010101101 },
    { 30, 0b100101111001001000101011100001 },
    { 31, 0b1000000000000000000000000000100 },
    { 31, 0b1000000000000000000000000000111 },
    { 31, 0b1000000000000000001000010000100 },
    { 31, 0b1000000000000001000000010001110 },
    { 31, 0b1000000000010000100000000011100 },
    { 31, 0b1000000000010100000000001010100 },
    { 31, 0b1000000000100000000100000000111 },
    { 31, 0b1000000011000000110000001001100 },
    { 31, 0b1000001000001000010000001000111 },
    { 31, 0b1000100010001000100010001000100 },
    { 31, 0b1000100010001000100011101110111 },
    { 32, 0b10000000001000000000000000000011 },
    { 32, 0b10000000001110110101101010101001 },
    { 32, 0b10000000010000011010001011110100 },
    { 32, 0b10000010011000001000111011011011 },
    { 32, 0b10000111111000010001011111000011 },
    { 32, 0b10001000000001101010011100110001 },
};

// From https://stackoverflow.com/questions/50517576/berlekamp-massey-minimal-lfsr-issues with minor modification
static void berlekamp_massey(ubyte * restrict c, uint * restrict deg, const ubyte * restrict s, const uint n)
{
    uint L = 0;
    ubyte b[n];
    ubyte t[n];
    uint d;
    uint i;
    int j;
    int m = -1;

    for (j = n; --j > 0;)
        b[j] = c[j] = 0;

    b[0] = c[0] = 1;
    for (i = 0; i < n; i++) {
        // Calculate discrepancy
        d = s[i];
        for (j = L; j > 0; --j)
            d ^= c[j] & s[i - j];

        if (d != 0) {
            // non-zero discrepancy

            // copy c to t
            for (j = n; --j >= 0;)
                t[j] = c[j];

            // XOR b (reversed) into c
            for (j = n - i + m; --j >= 0;)
                c[i - m + j] ^= b[j];

            if (L + L <= i) {
                // if L <= N / 2
                L = i + 1 - L;
                m = i;
                // copy t to b
                for (j = n; --j >= 0;)
                    b[j] = t[j];
            }
        }
    }

    *deg = L;
}

// Produces the next output of the LFSR
static uint lfsr_cycle(uint * restrict state, const uint p, const uint n)
{
    uint bit = __builtin_parity(*state & p);
    *state = (*state << 1) | bit;
    *state &= (1 << n) - 1;
    return bit;
}

static uint bitrev(uint x, const uint n)
{
    uint y = 0;
    for (uint i = 0; i < n; i++) {
        y = (y << 1) | (x & 1);
        x >>= 1;
    }
    return y;
}

static void poly_print1(uint mask)
{
    printf("1 +");
    for (uint i = 0; mask; i++, mask >>= 1) {
        if (mask & 1) {
            if (i == 0)
                printf(" x");
            else
                printf(" x^%u", i + 1);
            if ((mask >> 1) != 0)
                printf(" +");
        }
    }
    printf("\n");
}

static void poly_print2(const ubyte * restrict p, const uint deg)
{
    for (uint i = 0; i <= deg; i++) {
        if (p[i] != 0) {
            if (i == 0)
                printf(" 1");
            else if (i == 1)
                printf(" x");
            else
                printf(" x^%u", i);
            if (i != deg)
                printf(" +");
        }
    }
    printf("\n");
}

static int bm_verify(const ubyte * restrict data, const uint data_size, const ubyte * restrict p, const uint deg)
{
    // Convert BM output to polynomial mask
    uint mask = 0;
    for (uint i = 1; i <= deg; i++) {
        if (p[i])
            mask |= 1 << (i - 1);
    }

    // Set initial data from first deg(p) bits
    uint lfsr = 0;
    for (uint i = 0; i < deg; i++)
        lfsr = (lfsr << 1) | data[i];

    // Verify the rest of the data
    for (uint i = deg; i < data_size; i++) {
        if (lfsr_cycle(&lfsr, mask, deg) != data[i]) {
            printf("LFSR from BM failed to match\n");
            return -1;
        }
    }
    return 0;
}

int main(void)
{
    /* A LFSR recovery */

    printf("Berlekamp-Massey for a(x):\n");

    ubyte cA[ARRLEN(A_dataset)];
    uint degA;
    berlekamp_massey(cA, &degA, A_dataset, ARRLEN(A_dataset));
    if (bm_verify(A_dataset, ARRLEN(A_dataset), cA, degA))
        return -1;

    printf("\ndeg(a) = %u\na(x) =",degA);
    poly_print2(cA, degA);

    /* B LFSR recovery */

    printf("\nBerlekamp-Massey for b(x):\n");

    ubyte cB[ARRLEN(B_dataset)];
    uint degB;
    berlekamp_massey(cB, &degB, B_dataset, ARRLEN(B_dataset));
    if (bm_verify(B_dataset, ARRLEN(B_dataset), cB, degB))
        return -1;

    printf("\ndeg(b) = %u\nb(x) =",degB);
    poly_print2(cB, degB);

    /* C LFSR brute-forcing */

    printf("\nBrute-forcing for c(x):\n");

    for (uint data_num = 0; data_num < ARRLEN(C_datasets); data_num++) {
        const byte *data = C_datasets[data_num];

        uint n_unk = 0;
        for (uint i = 0; i < DATA_SIZE; i++)
            n_unk += data[i] == -1;

        printf("\nDataset %u (%u unknowns / %u total): ", data_num, n_unk, DATA_SIZE);

        bool ok = false;
        uint total_searches = 0;

        for (uint l = 0; l < ARRLEN(lfsrs); l++) {
            // Select new LFSR
            uint lfsr_degree = lfsrs[l].degree;
            uint lfsr_mask = lfsrs[l].mask;

            // The initial state consists of the first [degree] data points,
            // but some of these might be unknowns. We can just try every
            // possible initial state, so determine how many unknown bits are
            // in the initial state:
            uint n = 0;
            uint unknown_mask = 0;
            for (uint i = 0; i < lfsr_degree; i++) {
                if (data[i] == -1) {
                    unknown_mask |= 1 << i;
                    n++;
                }
            }

            if (n == 0) {
                // Initial state is fully known, no need to go through guessing initial states

                // Pull the initial state from the input data
                uint lfsr = 0;
                for (uint i = 0; i < lfsr_degree; i++)
                    lfsr = (lfsr << 1) | data[i];
                total_searches++;

                // Run the LFSR, compare against data points that are not unknowns (-1)
                bool fail = false;
                for (uint i = lfsr_degree; i < DATA_SIZE; i++) {
                    uint bit = lfsr_cycle(&lfsr, lfsr_mask, lfsr_degree);

                    if (data[i] != -1 && bit != (uint)data[i]) {
                        // Didn't match a known data point, move on to next LFSR
                        fail = true;
                        break;
                    }
                }
                if (!fail) {
                    // Every data point that is known was matched, we're done
                    printf("OK after searching %u LFSRs and %u initial states\n"
                           "deg(c) = %u\n"
                           "c(x) = ",
                           l, total_searches, lfsr_degree);
                    poly_print1(lfsr_mask);
                    ok = true;
                    break;
                }
                continue;
            }

            // At least one unknown bit in the initial state.

            // Build a lookup table that maps a consecutive sequence of bit
            // positions into the unknown bit positions
            uint lut[n];

            uint bitidx = 0;
            uint pos = 0;
            while (unknown_mask != 0) {
                if (unknown_mask & 1)
                    lut[pos++] = bitidx;
                unknown_mask >>= 1;
                bitidx++;
            }

            // For each 2^n choice of initial state, create and test it
            for (uint k = 0; k < (uint)(1 << n); k++) {
                // Pull the initial state from the input data, skipping unknown bits
                uint lfsr = 0;
                for (uint i = 0; i < lfsr_degree; i++) {
                    if (data[i] == -1)
                        lfsr = (lfsr << 1) | 0; // Insert a 0 for now, may be replaced below
                    else
                        lfsr = (lfsr << 1) | data[i];
                }

                // Fill in the unknown bits from bits of k to cover all the input states sequentially
                uint exp = 0;
                for (uint i = 0; i < n; i++) {
                    if (k & (1 << i))
                        exp |= 1 << lut[i];
                }

                // The lfsr bit positions are actually the reverse of this
                exp = bitrev(exp, lfsr_degree);
                // These two sets should be independent by construction
                assert((exp & lfsr) == 0);
                // Take the set union
                lfsr |= exp;

                total_searches++;

                // Run the initial state, compare to data points that are not unknown (-1)
                bool fail = false;
                for (uint i = lfsr_degree; i < DATA_SIZE; i++) {
                    uint bit = lfsr_cycle(&lfsr, lfsr_mask, lfsr_degree);

                    if (data[i] != -1 && bit != (uint)data[i]) {
                        // Didn't match, move on
                        fail = true;
                        break;
                    }
                }
                if (!fail) {
                    // Every data point that is known matched, quit
                    printf("OK after searching %u LFSRs and %u (%u total) attempts on initial state\n"
                           "deg(c) = %u\n"
                           "c(x) = ",
                           l, k, total_searches, lfsr_degree);
                    poly_print1(lfsr_mask);
                    ok = true;
                    break;
                }
            }
            if (ok)
                break;
        }

        if (!ok)
            printf("No match found!\n");
    }
    return 0;
}
